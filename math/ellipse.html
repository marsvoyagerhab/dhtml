<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Mars Voyager, 2021-01-23 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta charset="UTF-8"/> <!-- HTML5 -->
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/> <!-- HTML4 -->
        <meta name="viewport" content="width=device-width, initial-scale=0.9"/>

        <meta name="keywords" content="Creativity, DHTML, JavaScript"/>

        <title>Mars Voyager on Math</title>

        <link rel="preconnect" href="https://fonts.gstatic.com"/>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap"/> 

        <script type="text/javascript" src="../marsvoyager.js"></script>
        <link rel="stylesheet" href="../marsvoyager.css" type="text/css"/>
        <link rel="icon" href="../images/MarsVoyager_100x100.png"/>
        
        <!-- https://realfavicongenerator.net -->
        <link rel="apple-touch-icon" sizes="180x180" href="../icons/apple-touch-icon.png"/>
        <link rel="icon" type="image/png" sizes="32x32" href="../icons/favicon-32x32.png"/>
        <link rel="icon" type="image/png" sizes="16x16" href="../icons/favicon-16x16.png"/>
        <link rel="manifest" href="../icons/site.webmanifest"/>
        <link rel="mask-icon" href="../icons/safari-pinned-tab.svg" color="#5bbad5"/>
        <link rel="shortcut icon" href="../icons/favicon.ico"/>
        <meta name="msapplication-TileColor" content="#2b5797"/>
        <meta name="msapplication-config" content="../icons/browserconfig.xml"/>
        <meta name="theme-color" content="#ffffff"/>
        
        <style>
        img#Pen {
            z-index: 10;
            position: absolute;
            left: 0px;
            top: 0px;
            width: 100px;
            height: 100px;
        }
        div {
            width: 400px;
        }
        </style>
    </head>
    <body onload="start();">
        <h1>Drawing an ellipse</h1>
        
        <div>
            <canvas id="Canvas" onclick="stopOrStart();" width="400" height="300"></canvas>
            <img id="Pen" src="images/Pen.png" width="200" height="253"/>
        </div>
        
        <div>
            <ul>
                <li>Given are the width and height of the ellipse.</li>
                <li>The length of the string (red) shall be equal to the width, i.e. the major axis (2*a).</li>
                <li>The foci (F), at the equal distance (c) from the center, are found when the pen reaches the half height.</li>
                <li>The eccentricity of the ellipse is c/a.</li>
            </ul>
        
            <div>Wikipedia link</div>
            <ul>
                <li><a href="https://en.wikipedia.org/wiki/Ellipse">Ellipse</a></li>
            </ul>
        </div>
        
        <div id="Footer" data-depth="../" data-topic="Ellipse" data-version="1.0"></div>        

        <script>//<![CDATA[
        updatePage();

        const CANVAS = document.getElementById("Canvas");
        const ctx = CANVAS.getContext("2d");

        const PEN = document.getElementById("Pen");

        const DARKTEXTCOLOR = "#03081e"; // CSS background
        const TEXTCOLOR = "#ACA39A"; // same as in CSS
        const STRINGCOLOR = "red"; 
        const LINEWIDTH = 2;
        const ALPHA = "0.25"; // lower is more transparent

        const ANIMTIME = 50; // animation delay (ms)

        // ellipse
        const cx = CANVAS.width/2;
        const cy = CANVAS.height/2;
        const a = 3*CANVAS.width/8;
        const b = 2*CANVAS.height/6;

        const N = 100;
        const DA = Math.PI/N;

        let running = true;

        let X;
        let Y;
        let EN;

        let step;
        let N0;
        let N2;

        let interval;
        
        function start() {
            setDefault();
            interval = setInterval(drawBackground, ANIMTIME);
        }

        function setDefault() {
            X = 0;
            Y = 0;
            EN = 0;

            step = -1;
            N0 = 0;
            N2 = 0;
        }

        function stopOrStart() {
            clearInterval(interval);
            running = (!running);
            if (running) {
                drawBackground();
                interval = setInterval(drawBackground, ANIMTIME);
            } else {
                ctx.translate(cx, cy);
                ctx.shadowColor = "rgba(0,0,0,0)";
                drawText("Paused",  a/2, -b - 20, DARKTEXTCOLOR);
                ctx.translate(-cx, -cy);
            }
        }

        function drawBackground() {
            clearCanvas();
            ctx.translate(cx, cy);

            drawMark(-a, 0);
            drawMark(+a, 0);
            drawMark(0, -b);
            drawMark(0,  b);

            ctx.strokeStyle = TEXTCOLOR;
            ctx.lineWidth = LINEWIDTH;

            drawLine(-a, 0, a, 0);
            drawLine(0, -b, 0, b);

            drawString(X, Y);
            
            if (step > -1) {
                if (step == 0) {
                    Y = Y + 2;
                    if (Y > b) {
                        Y = b;
                        step = 1;
                    }
                } else if (step == 1) {
                    EN++;
                    X = a*Math.cos(EN*DA + Math.PI/2);
                    Y = b*Math.sin(EN*DA + Math.PI/2);
                    
                    if (EN > 2*N - 1) {
                        step = 2;
                    }
                } else if (step == 2) {
                    N2++;
                    if (N2*ANIMTIME > 2000) {
                        step = -1;
                        setDefault();
                    }
                }
            } else {
                N0++;
                if (N0*ANIMTIME > 3000) {
                    step = 0;
                }
            }
            
            ctx.translate(-cx, -cy);
        }
        function drawString(x, y) {
            let xp = a;
            if (step == 0) {
                xp = Math.sqrt(Math.pow(a, 2) - Math.pow(y, 2));
            } else if (step > 0) {
                // Foci
                xp = Math.sqrt(Math.pow(a, 2) - Math.pow(b, 2));

                drawMark(-xp, 0);
                drawMark(+xp, 0);

                drawText("F", -xp, -10, DARKTEXTCOLOR);
                drawText("F", +xp, -10, DARKTEXTCOLOR);

                ctx.strokeStyle = DARKTEXTCOLOR;
                ctx.beginPath();
                ctx.moveTo(0, b);
                for (let i = 0; i <= EN; i++) {
                    let ex = a*Math.cos(i*DA + Math.PI/2);
                    let ey = b*Math.sin(i*DA + Math.PI/2);
                    ctx.lineTo(ex, ey);
                }
                ctx.stroke();
            }
            
            ctx.shadowOffsetX = 2*LINEWIDTH;
            ctx.shadowOffsetY = 2*LINEWIDTH;
            ctx.shadowColor = TEXTCOLOR;
            ctx.shadowBlur = 2*LINEWIDTH;
            
            if (step != 2) {
                if (N0*ANIMTIME > 1500) {
                    let endL = b/3; // length of dangling string ends

                    ctx.strokeStyle = STRINGCOLOR;
                    ctx.lineWidth = 2*LINEWIDTH;

                    // string
                    drawLine(-xp, 0, x, y);
                    drawLine(+xp, 0, x, y);

                    // ends
                    drawLine(-xp, endL,-xp, 0);
                    drawLine(+xp, endL, xp, 0);

                    // pins
                    ctx.strokeStyle = DARKTEXTCOLOR;
                    ctx.lineWidth = LINEWIDTH;
                    
                    drawCircle(-xp, 0, 2);
                    drawCircle(+xp, 0, 2);
                }
            }
            ctx.drawImage(PEN, x, y - PEN.height, PEN.width, PEN.height);

            let vp = CANVAS.getBoundingClientRect(); // in viewport
            let scrollLeft = (window.pageXOffset || document.documentElement.scrollLeft);
            let scrollTop = (window.pageYOffset || document.documentElement.scrollTop);

            PEN.style.left = (x + cx + (vp.left + scrollLeft)) + "px";
            PEN.style.top  = (y + cy + (vp.top + scrollTop) - PEN.height) + "px";
        }

        function clearCanvas() {
            //ctx.clearRect(0, 0, CANVAS.width, CANVAS.height);
            ctx.shadowColor = "rgba(0,0,0,0)";
            ctx.fillStyle = "white";
            ctx.fillRect(0, 0, CANVAS.width, CANVAS.height);
        }
        function drawLine(x1, y1, x2, y2) {
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
        }
        function drawMark(x, y) {
            ctx.strokeStyle = TEXTCOLOR;
            ctx.lineWidth = LINEWIDTH;

            let s = 8;

            ctx.beginPath();
            ctx.moveTo(x - s, y);
            ctx.lineTo(x + s, y);
            ctx.moveTo(x, y - s);
            ctx.lineTo(x, y + s);
            ctx.stroke();
        }
        function drawCircle(x, y, r) {
            ctx.beginPath();
            ctx.arc(x, y, r, 0, 2*Math.PI);
            ctx.stroke();
        }
        function drawText(txt, x, y, color) {
            let fontSize = 18;

            ctx.fillStyle = color;
            ctx.font = fontSize + "px Arial";
            ctx.textAlign = "center";

            ctx.fillText(txt, x, y);
        }        
        //]]></script>
    </body>
</html>
